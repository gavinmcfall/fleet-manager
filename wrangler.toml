name = "fleet-manager"
main = "src/index.ts"
compatibility_date = "2025-02-18"

# Workers Assets — SPA routing: unmatched paths serve index.html
[assets]
binding = "ASSETS"
not_found_handling = "single-page-application"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "fleet-manager"
database_id = "placeholder-create-with-wrangler-d1-create"
migrations_dir = "src/db/migrations"

# Cron Triggers — staggered nightly sync to stay within Workers CPU limits
# Each step runs as a separate invocation with its own 30s CPU budget
[triggers]
crons = [
  "0 3 * * *",   # SC Wiki sync
  "15 3 * * *",  # FleetYards ship images
  "30 3 * * *",  # scunpacked paints + FleetYards paint images
  "45 3 * * *",  # RSI API images (if enabled)
]

# Environment variables (non-secret defaults)
[vars]
FLEETYARDS_BASE_URL = "https://api.fleetyards.net"
SC_WIKI_ENABLED = "true"
SC_WIKI_RATE_LIMIT = "1.0"
SC_WIKI_BURST = "5"
RSI_API_ENABLED = "false"
RSI_BASE_URL = "https://robertsspaceindustries.com"
RSI_RATE_LIMIT = "1.0"
SCUNPACKED_REPO = "StarCitizenWiki/scunpacked-data"
SCUNPACKED_BRANCH = "main"
